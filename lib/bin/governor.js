#!/usr/bin/env node
"use strict";

var _commander = _interopRequireDefault(require("commander"));

var _assert = _interopRequireDefault(require("assert"));

var _inquirer = _interopRequireDefault(require("inquirer"));

var _chalk = _interopRequireDefault(require("chalk"));

var sync = _interopRequireWildcard(require("../sync"));

var _server = _interopRequireDefault(require("../server"));

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_commander.default.version('0.0.1');

_commander.default.command('sync').description('sync state of public and private stories').option('-u, --public-project-id <id>', 'Project ID of the public project').option('-r, --private-project-id <id>', 'Project ID of the private project').option('-d, --dry-run', 'Don\'t perform any changes, print actions').option('-y, --yes', 'Automatic yes to prompts').option('-s, --silent', 'Use with --yes to silently change all stories').option('-n, --no-comments', 'Don\'t post comments about updated state').action(function (cmd) {
  (0, _assert.default)(cmd.publicProjectId, 'Public project ID is required');
  (0, _assert.default)(cmd.privateProjectId, 'Private project ID is required');
  const publicProjectId = +cmd.publicProjectId;
  const privateProjectId = +cmd.privateProjectId;
  sync.getOutOfSyncStories(publicProjectId, privateProjectId).then(outOfSyncStories => {
    if (!cmd.silent) {
      sync.printStories(outOfSyncStories);
    }

    return (cmd.yes ? Promise.resolve(outOfSyncStories) : promptStoriesToChange(outOfSyncStories)).then(storiesToChange => {
      if (cmd.dryRun) {
        return [];
      }

      return sync.syncPublicStoriesState(publicProjectId, storiesToChange);
    }).then(updatedStories => {
      if (!cmd.noComments) {
        sync.commentAboutSyncedState(publicProjectId, updatedStories);
      }
    });
  });
});

_commander.default.command('server').description('start server to listen for project activity and sync stories state').option('-u, --public-project-id <id>', 'Project ID of the public project').option('-r, --private-project-id <id>', 'Project ID of the private project').action(function (cmd) {
  (0, _assert.default)(cmd.publicProjectId, 'Public project ID is required');
  (0, _assert.default)(cmd.privateProjectId, 'Private project ID is required');
  const publicProjectId = +cmd.publicProjectId;
  const privateProjectId = +cmd.privateProjectId;
  (0, _server.default)(publicProjectId, privateProjectId).then(port => {
    console.log(`Server started on port: ${port}`);
  }).catch(console.error.bind(console));
});

_commander.default.parse(process.argv);

function promptStoriesToChange(outOfSyncStories) {
  return _inquirer.default.prompt(outOfSyncStories.map(story => ({
    type: 'expand',
    message: `Change ${_chalk.default.blue(story.name)} state from ${_chalk.default.red(story.currentState)} to ${_chalk.default.green(story.actualState)}?`,
    default: 'change',
    name: story.publicId,
    choices: [{
      key: 'y',
      name: 'Change',
      value: 'change'
    }, {
      key: 'a',
      name: 'Change this one and all next',
      value: 'change_all'
    }, {
      key: 'n',
      name: 'Don\'t change',
      value: 'dont'
    }, {
      key: 'd',
      name: 'Don\'t change this and all next',
      value: 'dont_all'
    }, {
      key: 'q',
      name: 'Quit',
      value: 'quit'
    }],
    when: answers => Object.values(answers).every(a => a !== 'quit' && a !== 'change_all' && a !== 'dont_all')
  }))).then(answers => {
    const quit = Object.values(answers).some(a => a === 'quit');

    if (quit) {
      return [];
    }

    const changeAll = Object.values(answers).some(a => a === 'change_all');
    return changeAll ? outOfSyncStories : outOfSyncStories.filter(story => answers[story.publicId] === 'change');
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9iaW4vZ292ZXJub3IuanMiXSwibmFtZXMiOlsicHJvZ3JhbSIsInZlcnNpb24iLCJjb21tYW5kIiwiZGVzY3JpcHRpb24iLCJvcHRpb24iLCJhY3Rpb24iLCJjbWQiLCJwdWJsaWNQcm9qZWN0SWQiLCJwcml2YXRlUHJvamVjdElkIiwic3luYyIsImdldE91dE9mU3luY1N0b3JpZXMiLCJ0aGVuIiwib3V0T2ZTeW5jU3RvcmllcyIsInNpbGVudCIsInByaW50U3RvcmllcyIsInllcyIsIlByb21pc2UiLCJyZXNvbHZlIiwicHJvbXB0U3Rvcmllc1RvQ2hhbmdlIiwic3Rvcmllc1RvQ2hhbmdlIiwiZHJ5UnVuIiwic3luY1B1YmxpY1N0b3JpZXNTdGF0ZSIsInVwZGF0ZWRTdG9yaWVzIiwibm9Db21tZW50cyIsImNvbW1lbnRBYm91dFN5bmNlZFN0YXRlIiwicG9ydCIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImVycm9yIiwiYmluZCIsInBhcnNlIiwicHJvY2VzcyIsImFyZ3YiLCJpbnF1aXJlciIsInByb21wdCIsIm1hcCIsInN0b3J5IiwidHlwZSIsIm1lc3NhZ2UiLCJjaGFsayIsImJsdWUiLCJuYW1lIiwicmVkIiwiY3VycmVudFN0YXRlIiwiZ3JlZW4iLCJhY3R1YWxTdGF0ZSIsImRlZmF1bHQiLCJwdWJsaWNJZCIsImNob2ljZXMiLCJrZXkiLCJ2YWx1ZSIsIndoZW4iLCJhbnN3ZXJzIiwiT2JqZWN0IiwidmFsdWVzIiwiZXZlcnkiLCJhIiwicXVpdCIsInNvbWUiLCJjaGFuZ2VBbGwiLCJmaWx0ZXIiXSwibWFwcGluZ3MiOiJBQUFBOzs7QUFJQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUFBLG1CQUNHQyxPQURILENBQ1csT0FEWDs7QUFHQUQsbUJBQ0dFLE9BREgsQ0FDVyxNQURYLEVBRUdDLFdBRkgsQ0FFZSwwQ0FGZixFQUdHQyxNQUhILENBR1UsOEJBSFYsRUFHMEMsa0NBSDFDLEVBSUdBLE1B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QUF2QyxDQUFiOztBQUVBLFFBQUlDLElBQUosRUFBVTtBQUNSLGFBQU8sRUFBUDtBQUNEOztBQUVELFVBQU1FLFNBQVMsR0FBR04sTUFBTSxDQUFDQyxNQUFQLENBQWNGLE9BQWQsRUFBdUJNLElBQXZCLENBQTRCRixDQUFDLElBQUlBLENBQUMsS0FBSyxZQUF2QyxDQUFsQjtBQUVBLFdBQU9HLFNBQVMsR0FDWmhELGdCQURZLEdBRVpBLGdCQUFnQixDQUFDaUQsTUFBakIsQ0FBeUJ4QixLQUFELElBQVdnQixPQUFPLENBQUNoQixLQUFLLENBQUNXLFFBQVAsQ0FBUCxLQUE0QixRQUEvRCxDQUZKO0FBR0QsR0FqREksQ0FBUDtBQWtERCIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcblxuLy8gQGZsb3dcblxuaW1wb3J0IHByb2dyYW0gZnJvbSAnY29tbWFuZGVyJ1xuaW1wb3J0IGFzc2VydCBmcm9tICdhc3NlcnQnXG5pbXBvcnQgaW5xdWlyZXIgZnJvbSAnaW5xdWlyZXInXG5pbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnXG5pbXBvcnQgKiBhcyBzeW5jIGZyb20gJy4uL3N5bmMnXG5pbXBvcnQgc2VydmVyIGZyb20gJy4uL3NlcnZlcidcblxucHJvZ3JhbVxuICAudmVyc2lvbignMC4wLjEnKVxuXG5wcm9ncmFtXG4gIC5jb21tYW5kKCdzeW5jJylcbiAgLmRlc2NyaXB0aW9uKCdzeW5jIHN0YXRlIG9mIHB1YmxpYyBhbmQgcHJpdmF0ZSBzdG9yaWVzJylcbiAgLm9wdGlvbignLXUsIC0tcHVibGljLXByb2plY3QtaWQgPGlkPicsICdQcm9qZWN0IElEIG9mIHRoZSBwdWJsaWMgcHJvamVjdCcpXG4gIC5vcHRpb24oJy1yLCAtLXByaXZhdGUtcHJvamVjdC1pZCA8aWQ+JywgJ1Byb2plY3QgSUQgb2YgdGhlIHByaXZhdGUgcHJvamVjdCcpXG4gIC5vcHRpb24oJy1kLCAtLWRyeS1ydW4nLCAnRG9uXFwndCBwZXJmb3JtIGFueSBjaGFuZ2VzLCBwcmludCBhY3Rpb25zJylcbiAgLm9wdGlvbignLXksIC0teWVzJywgJ0F1dG9tYXRpYyB5ZXMgdG8gcHJvbXB0cycpXG4gIC5vcHRpb24oJy1zLCAtLXNpbGVudCcsICdVc2Ugd2l0aCAtLXllcyB0byBzaWxlbnRseSBjaGFuZ2UgYWxsIHN0b3JpZXMnKVxuICAub3B0aW9uKCctbiwgLS1uby1jb21tZW50cycsICdEb25cXCd0IHBvc3QgY29tbWVudHMgYWJvdXQgdXBkYXRlZCBzdGF0ZScpXG4gIC5hY3Rpb24oZnVuY3Rpb24oY21kKSB7XG4gICAgYXNzZXJ0KGNtZC5wdWJsaWNQcm9qZWN0SWQsICdQdWJsaWMgcHJvamVjdCBJRCBpcyByZXF1aXJlZCcpXG4gICAgYXNzZXJ0KGNtZC5wcml2YXRlUHJvamVjdElkLCAnUHJpdmF0ZSBwcm9qZWN0IElEIGlzIHJlcXVpcmVkJylcblxuICAgIGNvbnN0IHB1YmxpY1Byb2plY3RJZCA9ICtjbWQucHVibGljUHJvamVjdElkO1xuICAgIGNvbnN0IHByaXZhdGVQcm9qZWN0SWQgPSArY21kLnByaXZhdGVQcm9qZWN0SWQ7XG5cbiAgICBzeW5jLmdldE91dE9mU3luY1N0b3JpZXMocHVibGljUHJvamVjdElkLCBwcml2YXRlUHJvamVjdElkKVxuICAgICAgLnRoZW4ob3V0T2ZTeW5jU3RvcmllcyA9PiB7XG4gICAgICAgIGlmICghY21kLnNpbGVudCkge1xuICAgICAgICAgIHN5bmMucHJpbnRTdG9yaWVzKG91dE9mU3luY1N0b3JpZXMpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKGNtZC55ZXMgPyBQcm9taXNlLnJlc29sdmUob3V0T2ZTeW5jU3RvcmllcykgOiBwcm9tcHRTdG9yaWVzVG9DaGFuZ2Uob3V0T2ZTeW5jU3RvcmllcykpXG4gICAgICAgICAgLnRoZW4oc3Rvcmllc1RvQ2hhbmdlID0+IHtcbiAgICAgICAgICAgIGlmIChjbWQuZHJ5UnVuKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHN5bmMuc3luY1B1YmxpY1N0b3JpZXNTdGF0ZShwdWJsaWNQcm9qZWN0SWQsIHN0b3JpZXNUb0NoYW5nZSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbigodXBkYXRlZFN0b3JpZXMpID0+IHtcbiAgICAgICAgICAgIGlmICghY21kLm5vQ29tbWVudHMpIHtcbiAgICAgICAgICAgICAgc3luYy5jb21tZW50QWJvdXRTeW5jZWRTdGF0ZShwdWJsaWNQcm9qZWN0SWQsIHVwZGF0ZWRTdG9yaWVzKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICB9KVxuICB9KVxuXG5wcm9ncmFtXG4gIC5jb21tYW5kKCdzZXJ2ZXInKVxuICAuZGVzY3JpcHRpb24oJ3N0YXJ0IHNlcnZlciB0byBsaXN0ZW4gZm9yIHByb2plY3QgYWN0aXZpdHkgYW5kIHN5bmMgc3RvcmllcyBzdGF0ZScpXG4gIC5vcHRpb24oJy11LCAtLXB1YmxpYy1wcm9qZWN0LWlkIDxpZD4nLCAnUHJvamVjdCBJRCBvZiB0aGUgcHVibGljIHByb2plY3QnKVxuICAub3B0aW9uKCctciwgLS1wcml2YXRlLXByb2plY3QtaWQgPGlkPicsICdQcm9qZWN0IElEIG9mIHRoZSBwcml2YXRlIHByb2plY3QnKVxuICAuYWN0aW9uKGZ1bmN0aW9uKGNtZCkge1xuICAgIGFzc2VydChjbWQucHVibGljUHJvamVjdElkLCAnUHVibGljIHByb2plY3QgSUQgaXMgcmVxdWlyZWQnKVxuICAgIGFzc2VydChjbWQucHJpdmF0ZVByb2plY3RJZCwgJ1ByaXZhdGUgcHJvamVjdCBJRCBpcyByZXF1aXJlZCcpXG5cbiAgICBjb25zdCBwdWJsaWNQcm9qZWN0SWQgPSArY21kLnB1YmxpY1Byb2plY3RJZDtcbiAgICBjb25zdCBwcml2YXRlUHJvamVjdElkID0gK2NtZC5wcml2YXRlUHJvamVjdElkO1xuXG4gICAgc2VydmVyKHB1YmxpY1Byb2plY3RJZCwgcHJpdmF0ZVByb2plY3RJZClcbiAgICAgIC50aGVuKChwb3J0KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBTZXJ2ZXIgc3RhcnRlZCBvbiBwb3J0OiAke3BvcnR9YClcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvci5iaW5kKGNvbnNvbGUpKVxuICB9KVxuXG5cbnByb2dyYW0ucGFyc2UocHJvY2Vzcy5hcmd2KVxuXG5mdW5jdGlvbiBwcm9tcHRTdG9yaWVzVG9DaGFuZ2Uob3V0T2ZTeW5jU3Rvcmllcykge1xuICByZXR1cm4gaW5xdWlyZXJcbiAgICAucHJvbXB0KFxuICAgICAgb3V0T2ZTeW5jU3Rvcmllcy5tYXAoc3RvcnkgPT4gKHtcbiAgICAgICAgdHlwZTogJ2V4cGFuZCcsXG4gICAgICAgIG1lc3NhZ2U6IGBDaGFuZ2UgJHtjaGFsay5ibHVlKHN0b3J5Lm5hbWUpfSBzdGF0ZSBmcm9tICR7Y2hhbGsucmVkKHN0b3J5LmN1cnJlbnRTdGF0ZSl9IHRvICR7Y2hhbGsuZ3JlZW4oc3RvcnkuYWN0dWFsU3RhdGUpfT9gLFxuICAgICAgICBkZWZhdWx0OiAnY2hhbmdlJyxcbiAgICAgICAgbmFtZTogc3RvcnkucHVibGljSWQsXG4gICAgICAgIGNob2ljZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBrZXk6ICd5JyxcbiAgICAgICAgICAgIG5hbWU6ICdDaGFuZ2UnLFxuICAgICAgICAgICAgdmFsdWU6ICdjaGFuZ2UnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAga2V5OiAnYScsXG4gICAgICAgICAgICBuYW1lOiAnQ2hhbmdlIHRoaXMgb25lIGFuZCBhbGwgbmV4dCcsXG4gICAgICAgICAgICB2YWx1ZTogJ2NoYW5nZV9hbGwnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAga2V5OiAnbicsXG4gICAgICAgICAgICBuYW1lOiAnRG9uXFwndCBjaGFuZ2UnLFxuICAgICAgICAgICAgdmFsdWU6ICdkb250JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGtleTogJ2QnLFxuICAgICAgICAgICAgbmFtZTogJ0RvblxcJ3QgY2hhbmdlIHRoaXMgYW5kIGFsbCBuZXh0JyxcbiAgICAgICAgICAgIHZhbHVlOiAnZG9udF9hbGwnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAga2V5OiAncScsXG4gICAgICAgICAgICBuYW1lOiAnUXVpdCcsXG4gICAgICAgICAgICB2YWx1ZTogJ3F1aXQnLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHdoZW46IGFuc3dlcnMgPT4gT2JqZWN0LnZhbHVlcyhhbnN3ZXJzKS5ldmVyeShhID0+IGEgIT09ICdxdWl0JyAmJiBhICE9PSAnY2hhbmdlX2FsbCcgJiYgYSAhPT0gJ2RvbnRfYWxsJyksXG4gICAgICB9KSksXG4gICAgKVxuICAgIC50aGVuKChhbnN3ZXJzKSA9PiB7XG4gICAgICBjb25zdCBxdWl0ID0gT2JqZWN0LnZhbHVlcyhhbnN3ZXJzKS5zb21lKGEgPT4gYSA9PT0gJ3F1aXQnKVxuXG4gICAgICBpZiAocXVpdCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNoYW5nZUFsbCA9IE9iamVjdC52YWx1ZXMoYW5zd2Vycykuc29tZShhID0+IGEgPT09ICdjaGFuZ2VfYWxsJylcblxuICAgICAgcmV0dXJuIGNoYW5nZUFsbFxuICAgICAgICA/IG91dE9mU3luY1N0b3JpZXNcbiAgICAgICAgOiBvdXRPZlN5bmNTdG9yaWVzLmZpbHRlcigoc3RvcnkpID0+IGFuc3dlcnNbc3RvcnkucHVibGljSWRdID09PSAnY2hhbmdlJylcbiAgICB9KVxufVxuIl19